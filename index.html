<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clock Token Sender</title>
    <script>
        async function send() {
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');
            const binID = params.get('binID');

            if (!token || !binID) {
                alert("Token and Bin ID are required.");
                return;
            }

            const binUrl = `https://api.jsonbin.io/v3/b/${binID}`;
            const headers = {
                "Content-Type": "application/json"
            };

            // Fetch the current tokens from the bin
            const res = await fetch(binUrl);
            if (!res.ok) {
                document.body.innerHTML = "<h1>Error fetching data from the bin. Try again.</h1>";
                return;
            }
            const data = await res.json();
            const currentTokens =  data.tokens || [];

            // Add the token if it doesn't already exist
            if (!currentTokens.includes(token)) {
                currentTokens.push(token);
            }

            // Update the bin with the new tokens
            const update = await fetch(binUrl, {
                method: "PUT",
                headers,
                body: JSON.stringify({ tokens: currentTokens }, null, 2)
            });

            if (!update.ok) {
                document.body.innerHTML = "<h1>Error updating the bin. Try again.</h1>";
            }
            else {
                document.body.innerHTML = "<h1>Token sent successfully!</h1>";
            }
        }
        window.onload = send;
    </script>
</head>
<body>
    <h1>Sending Token...</h1>
</body>
</html>